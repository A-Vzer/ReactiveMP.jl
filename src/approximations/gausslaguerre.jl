export glquadrature, GaussLaguerreQuadrature

import FastGaussQuadrature: gausslaguerre
import StatsFuns: sqrtÏ€

const gausslaguerre_precomputed_sigma_pointsweights = (
    ([1.0], [1.0]), 
    ([0.5857864376269049, 3.414213562373095], [0.8535533905932732, 0.14644660940672624]), 
    ([0.4157745567834814, 2.2942803602790467, 6.2899450829374794], [0.7110930099291746, 0.27851773356923976, 0.010389256501586142]), 
    ([0.32254768961939234, 1.7457611011583447, 4.536620296921119, 9.395070912301126], [0.6031541043416333, 0.35741869243779956, 0.03888790851500564, 0.0005392947055613248]), 
    ([0.2635603197181408, 1.413403059106515, 3.596425771040715, 7.08581000585883, 12.640800844275773], [0.5217556105828078, 0.39866681108317664, 0.0759424496817078, 0.0036117586799220445, 2.336997238577608e-5]), 
    ([0.22284660417926067, 1.1889321016726206, 2.992736326059312, 5.775143569104506, 9.837467418382593, 15.98287398060172], [0.45896467394996343, 0.4170008307721205, 0.1133733820740453, 0.010399197453149092, 0.00026101720281492815, 8.985479064295956e-7]), 
    ([0.19304367656036234, 1.026664895339191, 2.5678767449507442, 4.9003530845264756, 8.182153444562845, 12.734180291797813, 19.395727862262497], [0.40931895170127314, 0.42183127786172037, 0.14712634865750523, 0.02063351446871699, 0.0010740101432807488, 1.5865464348564033e-5, 3.17031547899568e-8]), 
    ([0.17027963230510096, 0.9037017767993786, 2.251086629866126, 4.266700170287654, 7.045905402393456, 10.758516010180994, 15.740678641277999, 22.86313173688926], [0.36918858934163723, 0.4187867808143427, 0.17579498663717222, 0.033343492261215836, 0.0027945362352256656, 9.076508773358196e-5, 8.485746716272536e-7, 1.048001174871487e-9]), 
    ([0.15232222773180829, 0.8072200227422546, 2.0051351556193464, 3.7834739733312306, 6.2049567778766095, 9.37298525168756, 13.466236911092084, 18.83359778899169, 26.374071890927368], [0.3361264217979624, 0.41121398042398394, 0.19928752537088631, 0.04746056276565154, 0.005599626610794583, 0.00030524976709321415, 6.592123026075344e-6, 4.11076933034949e-8, 3.2908740303506715e-11]),
    ([0.13779347054049243, 0.729454549503169, 1.8083429017403172, 3.4014336978548982, 5.552496140063803, 8.33015274676449, 11.843785837900052, 16.279257831378107, 21.996585811980754, 29.920697012273894], [0.3084411157650199, 0.4011199291552741, 0.21806828761180852, 0.062087456098678134, 0.009501516975181123, 0.000753008388587533, 2.8259233495995608e-5, 4.249313984962601e-7, 1.8395648239796106e-9, 9.911827219608853e-13]), 
    ([0.12579644218796757, 0.6654182558392282, 1.647150545872169, 3.0911381430352542, 5.0292844015798295, 7.509887863806612, 10.605950999546971, 14.431613758064199, 19.178857403214685, 25.217709339677587, 33.497192847175576], [0.2849332128941993, 0.3897208895278513, 0.23278183184899098, 0.07656445354619669, 0.014393282767350647, 0.0015188808464848631, 8.51312243547167e-5, 2.292403879574444e-6, 2.4863537027677336e-8, 7.712626933691054e-11, 2.8837758683234904e-14]), 
    ([0.11572211735802083, 0.6117574845151317, 1.5126102697764197, 2.8337513377435086, 4.5992276394183484, 6.844525453115175, 9.621316842456867, 13.006054993306345, 17.116855187462264, 22.151090379397015, 28.487967250984003, 37.099121044466926], [0.26473137105544275, 0.37775927587313873, 0.244082011319878, 0.09044922221168056, 0.02010238115463409, 0.0026639735418652693, 0.00020323159266299662, 8.365055856819726e-6, 1.6684938765408833e-7, 1.3423910305149906e-9, 3.0616016350349957e-12, 8.148077467426219e-16]), 
    ([0.1071423884722522, 0.5661318990404028, 1.3985643364510214, 2.616597108406411, 4.23884592901703, 6.292256271140077, 8.815001941186981, 11.86140358881125, 15.510762037703774, 19.884635663880232, 25.18526386467775, 31.800386301947253, 40.72300866926557], [0.24718870842996254, 0.3656888229005223, 0.2525624200576587, 0.10347075802418379, 0.026432754415561383, 0.004220396040254733, 0.0004118817704727313, 2.351547398155279e-5, 7.317311620248946e-7, 1.1088416257039761e-8, 6.770826692205915e-11, 1.1599799599051051e-13, 2.2450932038927877e-17]), 
    ([0.0997475070325978, 0.5268576488519041, 1.300629121251497, 2.4308010787308456, 3.9321028222932193, 5.825536218301706, 8.140240141565139, 10.916499507366018, 14.21080501116129, 18.104892220218094, 22.723381628269617, 28.272981723248204, 35.14944366059241, 44.36608171111733], [0.23181557714486625, 0.3537846915975431, 0.25873461024542715, 0.11548289355692307, 0.03319209215933764, 0.006192869437006623, 0.0007398903778673795, 5.4907194668416635e-5, 2.4095857640853866e-6, 5.8015439816765414e-8, 6.819314692485016e-10, 3.2212077518949158e-12, 4.221352440516648e-15, 6.052375022289718e-19]), 
    ([0.09330781201728172, 0.49269174030188373, 1.2155954120709491, 2.2699495262037432, 3.6676227217514374, 5.425336627413553, 7.5659162266130675, 10.120228568019114, 13.130282482175723, 16.65440770832996, 20.776478899448765, 25.62389422672878, 31.40751916975394, 38.53068330648601, 48.026085572685794], [0.21823488594008658, 0.34221017792288067, 0.2630275779416802, 0.1264258181059303, 0.04020686492100096, 0.008563877803611838, 0.0012124361472142515, 0.00011167439234425186, 6.459926762022872e-6, 2.226316907096121e-7, 4.227430384979361e-9, 3.921897267041092e-11, 1.4565152640731237e-13, 1.48302705111304e-16, 1.6005949062110902e-20])
)

struct GaussLaguerreQuadrature{PI, WI} <: AbstractApproximationMethod
    p     :: Int
    piter :: PI
    witer :: WI
end

approximation_name(approx::GaussLaguerreQuadrature)       = "GaussLaguerre($(approx.p))"
approximation_short_name(approx::GaussLaguerreQuadrature) = "GL$(approx.p)"

function glquadrature(p::Int)
    points, weights = p <= length(gausslaguerre_precomputed_sigma_pointsweights) ? gausslaguerre_precomputed_sigma_pointsweights[p] : gausslaguerre(p)

    return GaussLaguerreQuadrature(p, points, weights)
end

function getweights(gl::GaussLaguerreQuadrature, mean, variance)
    return gl.witer
end

function getpoints(gl::GaussLaguerreQuadrature, mean, variance)
    return gl.piter
end